on:
    pull_request:
        types: [opened, synchronize, reopened]
    push:
        branches:
            - "master"
        tags:
            - "**"

name: "Continuous Integration"

jobs:
    build:
        runs-on: "ubuntu-latest"

        strategy:
            matrix:
                java-version:
                    - "11"

        name: "Java ${{ matrix.java-version }}"
        steps:
            - uses: "actions/checkout@v2"

            - uses: "actions/cache@v2"
              with:
                  path: "~/.m2/repository"
                  key: ${{ runner.os }}-maven-${{ hashFiles('**/pom.xml') }}
                  restore-keys: |
                      ${{ runner.os }}-maven-

            - name: "Setup java"
              uses: "actions/setup-java@v2"
              with:
                  distribution: 'temurin'
                  java-version: ${{ matrix.java-version }}
                  cache: 'maven'

            - name: "Configure Git user"
              run: |
                  git config user.email "actions@github.com"
                  git config user.name "GitHub Actions"

            - name: "gradle publish"
              uses: gradle/gradle-build-action@v2
              env:
                  GITHUB_USER: ${{ GITHUB_ACTOR }}
                  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
              with:
                  arguments: publish
